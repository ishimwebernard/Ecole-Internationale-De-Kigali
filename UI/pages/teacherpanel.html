<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="../css/teacherpanel.css">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet"> 
    <title>Ecole International De Kigali</title>
</head>
<body>
    
    <div class="content">
        <div class="filler" id="filler">  </div>
        <div class="loader" id="loader">
            <img src="../assets/images/loader.gif" alt="">
            <h1>Loading ...</h1>
        </div>
       
        <!-- <div class="filler" id="filler">  f</div> -->
        <!-- <div class="fileUploader" id="fileUploader">
            <h1>Material Upload Wizard</h1>
            <input type="text" id="Subject" placeholder="Subject">
            <input type="text" id="Title" placeholder="Title">
            <select name="class" id="uploadClass">
                <option value="primary1">Primary 1</option>
                <option value="primary2">Primary 2</option>
                <option value="primary3">Primary 3</option>
                <option value="primary4">Primary 4</option>
                <option value="primary5">Primary 5</option>
            </select>
           <textarea name="description" id="Description" cols="30" rows="10" placeholder="Description"></textarea>
           <input type="file" name="" id="p1" hidden>
           <label for="p1">Upload</label>
           <button id="cancelUpload" onclick="cancelUploadF()">Cancel</button>

        </div> -->
        <div class="mobilemenu" id="mobilemenu">
            <div class="mainNavItems">
                <p class="mobileNavItem">Home</p>
                <p class="mobileNavItem">Our School</p>
                <p class="mobileNavItem">Strategy</p>
                <p class="mobileNavItem">Environment</p>
                <p class="mobileNavItem">Health and safety</p>
                <p class="mobileNavItem">Student Portal</p>
                <p class="mobileNavItem">Contact</p>
                <p class="mobileNavItem">Video Portal</p>

            </div>
            <div class="empty" onclick="revealHideMobileMenu()"> </div>
        </div>
        <div class="row1">
            <img src="../assets/images/schoollogo.png" id="schoollogo" alt="" class="logo">
            <div class="navgroup" id="navgroup">
                <div class="navItems">
                    <p class="navItem" onclick="location.href=`index.html`">Home</p>
                    <p class="navItem" onclick="location.href=`./pages/ourschool.html`">Our School</p>
                    <p class="navItem" onclick="location.href=`./pages/strategy.html`">Strategy</p>
                    <p class="navItem" onclick="location.href=`./pages/environment.html`">Environment</p>
                    <p class="navItem">Health and Safety</p>
                    <p class="navItem">Student Portal</p>
                    <p class="navItem">Contact</p>
                    <p class="navItem">Video Portal</p> 
                </div>
                <div class="hamburger" onclick="revealHideMobileMenu()">
                    <div class="line"> </div>
                    <div class="line"> </div>
                    <div class="line"> </div>
                    <div class="line"> </div>
                </div>
            </div>
        </div>
       <div class="elearning">
           <div class="leftnav">
               <p onclick="switchTab(0)">Material Upload Wizard</p>
               <p onclick="switchTab(1)">Uploaded Materials</p>
               <p onclick="logout()">Log Out</p>

           </div>
         
           <div class="rightnav" id="uploadMaterial">
            <div class="fileUploader" id="fileUploader">
                <div class="nameIdentifier">
                    <h1>Material Upload Wizard</h1>
                </div>
               <div class="inputContainer">
                <input type="text" id="Subject" placeholder="Subject">
                <input type="text" id="Title" placeholder="Title">
                <select name="class" id="uploadClass">
                    <option value="primary1">Primary 1</option>
                    <option value="primary2">Primary 2</option>
                    <option value="primary3">Primary 3</option>
                    <option value="primary4">Primary 4</option>
                    <option value="primary5">Primary 5</option>
                </select>
               <textarea name="description" id="Description" cols="30" rows="10" placeholder="Description"></textarea>
               <input type="file" name="" id="p1" hidden>
               <label for="p1">Upload</label>
               </div>
    
            </div>
        </div>
        <div class="rightnav" id="uploadedMaterials">
            <div class="nameIdentifier">
                <h1>Uploaded Materials</h1>
            </div>
            <!-- <div class="um">

                <p class="umTitle">Title</p>
                <p  class="umClass">Target Class</p>
                <p class="umDate">Date</p>
                <button class="umButton">View Material</button> -->
            </div>
            
        
        </div>
        <!-- <div class="footer">
            <div class="footergroup">
                <h2>Address</h2>
                <div class="item">
                    <img src="./assets/images/location_vector.png" alt="">
                    <p>KN XXX ST</p>
                </div>
                <div class="item">
                    <img src="./assets/images/call_vector.png" alt="">
                    <p>+250 788 305 488</p>
                </div>
                <div class="item">
                    <img src="./assets/images/message_vector.png" alt="">
                    <p>symka2001@yahoo.fr</p>
                </div>
            </div>
            <div class="footergroup">
                <h2>Follow us</h2>
                <div class="item">
                    <img src="./assets/images/facebook.png" alt="">
                    <p>Facebook</p>
                </div>
                <div class="item">
                    <img src="./assets/images/twitter.png" alt="">
                    <p>Twitter</p>
                </div>
                <div class="item">
                    <img src="./assets/images/linkedin_vector.png" alt="">
                    <p>Linked In</p>
                </div>
            </div>

            <div class="footergroup">
                <h2>Subscribe</h2>
             <input type="text" placeholder="Enter your email">
             <button>Subscribe</button>
            </div>

        </div> -->
       </div>


        <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-analytics.js"></script>
<script>
      // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyBLtbU8MWi_BHunfQ7b4a6JPad0Jdmeh9E",
    authDomain: "ecole-internationale-dekigli.firebaseapp.com",
    projectId: "ecole-internationale-dekigli",
    storageBucket: "ecole-internationale-dekigli.appspot.com",
    messagingSenderId: "669208960466",
    appId: "1:669208960466:web:07897e417b95a689cb3c0b",
    measurementId: "G-9EKFKSTZPN"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  let _UPLOADED_MATERIALS = [];
  let _TEACHER_PANEL = '';
  let _TEACHER_ID='';


  var cookies = document.cookie
                .split(';')
                .map(cookie => cookie.split('='))
                .reduce((accumulator, [key, value]) => ({
                    ...accumulator,
                    [key.trim()]: decodeURIComponent(value)
                }), {});
  _TEACHER_ID = cookies.EIKLOGINID;
  document.cookie = "EIKLOGINID=; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
console.log(_TEACHER_ID);
//UPLOADING THE  LEARNING MATERIAL
if(String(_TEACHER_ID) =='undefined'){
    location.href=`../index.html`;
}
  var choosefile = document.getElementById("p1").onchange = function(){
            var storageRef = firebase.storage().ref();
            var toDay = new Date();
            var userStorageRef = storageRef.child('primary1'+toDay);
            var uploadedMaterials = document.getElementById('uploadedMaterials');
            var filler = document.getElementById('filler');
            var loader = document.getElementById('loader');

            

            const selectedFile = document.getElementById('p1').files[0];
            filler.style.display = "block";
            loader.style.display = "block";
            userStorageRef.put(selectedFile).then(function(snapshot) {
                
                const fileDirectory = snapshot.ref.getDownloadURL().then(url=>{
                    var _MATERIALURL = url;
                    firebase.firestore().collection('assignment').doc('primary1').set({
                        englishDate: _MATERIALURL
                    });//6CZ6G2PlHSdlYD9bkfcYedW0JhG3

                    var Subject = document.getElementById('Subject').value;
  var Description = document.getElementById('Description').value;
var Title = document.getElementById('Title').value;
var uploadClass = document.getElementById('uploadClass').value;

                    console.log(Title);
                    firebase.firestore().collection(_TEACHER_ID).doc(String(Title)+"-"+uploadClass+"-"+String(new Date())).set({
                       "Subject": Subject,
                       "Description": Description,
                         "toDay": String(new Date()),
                         "name": Title,
                         "targetClass": uploadClass,
                        "documentUrl": _MATERIALURL
                     });


                }).catch(error=>{
                    alert(error);
                    console.log(error);
                });
                filler.style.display = "none";
            loader.style.display = "none";
            document.cookie = `EIKLOGINID=${_TEACHER_ID}`
            }).catch(error=>{
                alert(String(error));
                console.log(error);
            });

        };


        getUploadedMaterials();
       
        async function getUploadedMaterials(){
            var uploadedMaterials = document.getElementById('uploadedMaterials');
            var filler = document.getElementById('filler');
            var loader = document.getElementById('loader');

            filler.style.display = "block";
            loader.style.display = "block";
           await firebase.firestore().collection(_TEACHER_ID)
            .onSnapshot((querySnapshot) => {
                
                    querySnapshot.forEach((doc) => {
                        // console.log(doc.id); // For doc name
                        // console.log(doc.data());
                        uploadedMaterials.innerHTML+=`
                        <div class="um">
                            <p class="umTitle">Material Title: ${doc.data().name}</p>
                            <p class="umClass">Target Class: ${doc.data().targetClass}</p>
                            <p class="umDate">Date Uploaded: ${doc.data().toDay}</p>
                            <p class="umClass">Class Subject: ${doc.data().Subject}</p>
                            <p class="umClass">Material Description: ${doc.data().Description}</p>
                        <button onclick="window.open('${doc.data().documentUrl}', '_blank')">View Material</button>
            </div>
                        `;
                        var objectToStore = {
                            "Subject": doc.data().Subject,
                       "Description": doc.data().Description,
                         "toDay": doc.data().toDay,
                         "name": doc.data().name,
                         "targetClass": doc.data().targetClass,
                        "documentUrl": doc.data().documentUrl

                        }
                        _UPLOADED_MATERIALS.push(objectToStore);
        });
    });
    filler.style.display = "none";
            loader.style.display = "none";
}
console.log(_UPLOADED_MATERIALS);

function cancelUploadF(){
    var filler = document.getElementById('filler');
    var cancelUpload = document.getElementById('fileUploader');
    cancelUpload.style.display = 'none';
    filler.style.display = 'none';

}
function startUploadSession(){
    var filler = document.getElementById('filler');
    var cancelUpload = document.getElementById('fileUploader');
    cancelUpload.style.display = 'flex';
    filler.style.display = 'block';
}
function switchTab(n){
    var rightnav = document.getElementsByClassName('rightnav');
    for(let s of rightnav){
        s.style.display = 'none';
    }
    rightnav[n].style.display = 'block';
}
function logout(){
            firebase.auth().signOut().then(()=>{
                location.href = `../index.html`;
            }).catch(err=>{

            })
        }      
////////////////



var chooseVideo = document.getElementById("vidUpload").onchange = function() {
    var storageRef = firebase.storage().ref();
    var toDay = new Date();
    var userStorageRef = storageRef.child('video' + String(toDay));
    var uploadedMaterials = document.getElementById('uploadedMaterials');
    var filler = document.getElementById('filler');
    var loader = document.getElementById('loader');
   



    const selectedFile = document.getElementById('vidUpload').files[0];
    filler.style.display = "block";
    loader.style.display = "block";
    userStorageRef.put(selectedFile).then(function(snapshot) {

        const fileDirectory = snapshot.ref.getDownloadURL().then(url => {
            var _VIDEO_URL = url;
            var _VIDEO_TITLE = document.getElementById('videotitle').value;
            var _VIDEO_DESCRIPTION = document.getElementById('videodescription').value;


            console.log(Title);
            firebase.firestore().collection('videos').doc(_VIDEO_TITLE + String(toDay)).set({
                "VideoTitle": _VIDEO_TITLE,
                "VideoDescription": _VIDEO_DESCRIPTION,
                "VideoUrl": _VIDEO_URL
            });


        }).catch(error => {
            alert(error);
            console.log(error);
        });
        filler.style.display = "none";
        loader.style.display = "none";
    }).catch(error => {
        alert(String(error));
        console.log(error);
    });

};
        
</script>






</body>
</html>